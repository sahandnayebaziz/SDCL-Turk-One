<template name="adminWorkers">
	<div class="row">
		<div class="col-sm-12 top-buffer-25">
			<table class="table table-sm table-bordered table-striped">
				<thead>
				<tr>
					<th>worker</th>
					<th>session</th>
					<th># of solutions</th>
					<th>decision point</th>
					<th>status</th>
					<th># accepted</th>
					<th>actions</th>
				</tr>
				</thead>
				<tbody>
				{{#each workerTickets}}
					{{> workerTicketRow}}
				{{/each}}
				</tbody>
			</table>
		</div>
	</div>
</template>
<template name="workerTicketRow">
	<tr class="{{viewStatus}}">
		<td>{{workerId}}</td>
		<td>{{sessionId}}</td>
		<td>{{numberOfSolutionsComplexEnough}}</td>
		<td>{{decisionPoint.name}}</td>
		<td><span class="label {{viewStatusLabelClass}}">{{viewStatusLabelMessage}}</span></td>
		{{#if reviewed}}
			<td>{{numberOfSolutionsAccepted}}</td>
		{{else}}
			<td></td>
		{{/if}}
		<td>
			<a href="/worker/{{_id}}" class="btn btn-sm btn-primary">review</a>
			<button class="btn btn-sm btn-danger" data-toggle="modal" data-target="#modal{{_id}}">delete</button>
		</td>
	</tr>

	<!--delete modal-->
	<div class="modal fade" id="modal{{_id}}" tabindex="-1" role="dialog" aria-labelledby="modal{{_id}}"
	     aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
						<span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">Are you sure?</h4>
				</div>
				<div class="modal-body text-danger">
					You are about to delete the worker ticket for worker {{workerId}}.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">cancel</button>
					<button type="button" class="btn btn-danger delete">delete</button>
				</div>
			</div>
		</div>
	</div>
</template>

<template name="worker">
	<div class="container-fluid top-buffer-100 bottom-buffer-100">
		<div class="row bottom-buffer-50">
			<div class="col-xs-12">
				<a href="/admin"><strong>Back to admin</strong></a>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-5">
				<ul class="list-group">
					<li class="list-group-item"><span class="text-muted">ticket: </span> {{_id}}</li>
					<li class="list-group-item"><span class="text-muted">worker: </span>{{workerId}}</li>
					<li class="list-group-item"><span class="text-muted">session: </span>{{sessionId}}</li>
					<li class="list-group-item"><span class="text-muted">decision point: </span>{{decisionPoint.name}}</li>
					<li class="list-group-item"><span class="text-muted"># of solutions: </span>{{numberOfSolutionsComplexEnough}}</li>
					<li class="list-group-item"><span class="text-muted">time on home: </span>{{timeOnHomeInMinutes}}m</li>
					<li class="list-group-item"><span class="text-muted">time in tool: </span>{{timeInToolInMinutes}}m</li>
					<li class="list-group-item"><span class="text-muted">time on info: </span>{{timeOnInfoInMinutes}}m</li>
					{{#if quit}}
						<li class="list-group-item"><span class="text-danger"><strong>User has quit!</strong></span></li>
						{{else}}
						{{#if submitted}}
							<li class="list-group-item"><span class="text-muted">reviewed: </span>{{#if reviewed}} <span
								class="text-success">yes</span> {{else}} <span class="text-danger">no</span> {{/if}}</li>
							<li class="list-group-item"><span class="text-muted">accepted: </span>{{numberOfSolutionsAccepted}}</li>
							<li class="list-group-item"><span class="text-muted">rejected: </span>{{numberOfSolutionsRejected}}</li>
						{{/if}}
					{{/if}}
				</ul>
			</div>
			{{#if submitted}}
				<div class="col-xs-7">
					<div class="btn-group pull-right">
						<button class="btn btn-success btn-continue reviewed">reviewed</button>
						<button class="btn btn-secondary btn-continue cancelReviewed">cancel</button>
					</div>
				</div>
			{{/if}}
		</div>
		<div class="row top-buffer-50">
			<div class="col-xs-12" id="col-sketch">
				<ul class="list-group">
					{{#each solutions}}
						{{#if isComplexEnough}}
							{{> solutionReviewModule}}
						{{/if}}
					{{/each}}
				</ul>
			</div>
		</div>
	</div>
</template>
<template name="solutionReviewModule">
	<li class="list-group-item {{viewStatus}}">
		<div class="row">
			<div class="col-xs-12">
				<p><span class="text-muted">name: </span> {{name}}</p>
				<p><span class="text-muted">explanation: </span> {{explain}}</p>
				<p><span class="text-muted">time spent:</span> {{timeInMinutes}}m</p>
				<p><span class="text-muted">time spent name:</span> {{timeInName}}s</p>
				<p><span class="text-muted">time spent explain:</span> {{timeInExplain}}s</p>
				<canvas id="canvas-{{canvasNumber}}" class="canvas-sketch"></canvas>
			</div>
		</div>
		{{#if ../submitted}}
			<div class="row top-buffer-25 bottom-buffer-25">
				<div class="col-xs-12">
					<div class="btn-group pull-left">
						<button type="button" class="btn btn-success btn-continue accept">accept</button>
						<button type="button" class="btn btn-secondary btn-continue cancel">cancel</button>
					</div>
					<button type="button" class="btn btn-danger btn-continue pull-right reject">reject</button>
				</div>
			</div>
		{{/if}}

		<script>
			var canvasId = "canvas-" + {{canvasNumber}};
			var element = $("#" + canvasId);
			var canvasHeightShouldBe = 500;
			var canvasWidthShouldBe = $("#col-sketch").width() - 50;
			$(element).attr({"height": canvasHeightShouldBe, "width": canvasWidthShouldBe});

			var canvas = new fabric.Canvas(canvasId);
			canvas.loadFromJSON({{state}}).renderAll();
			canvas.selection = false;
			canvas.forEachObject(function (o) {
				o.selectable = false;
			});

		</script>
	</li>
</template>